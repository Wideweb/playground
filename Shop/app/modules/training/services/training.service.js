/**********************************************************************************************
 * Training Item Model
**********************************************************************************************/
class Model {

    /******************************************************************************************
     Initialization
     ******************************************************************************************/
    constructor(
        /* Object */ data
    ) {
        this.word = data.dictionaryItem.term;
        this.answer = data.dictionaryItem.translation;
        this.options = data.options;

        this.isAnswered = false;
        this.isCorrect = undefined;
    }
}

/**********************************************************************************************
 * Controller
 **********************************************************************************************/
const Controller = {
    list: [],
    index: 0,

    /******************************************************************************************
     * METHODS
     ******************************************************************************************
     * registration of a new instance
     ******************************************************************************************/
    register: (list = []) => {
        list.forEach(data => {
            let item = new Model(data);
            Controller.list.push(item);
        });

        return Controller.list;
    },

    /******************************************************************************************
     Clean up registered instances
     ******************************************************************************************/
    clear: () => {
        Controller.list = [];
        Controller.index = 0;
    }

};

/**********************************************************************************************
 * Access Provider
 **********************************************************************************************/
export default class {
    static get $inject() {
        return [
            'httpProxyService',
        ];
    }

    /******************************************************************************************
     * Initialization
     ******************************************************************************************/
    constructor(
        proxy
    ) {
        this.proxy = proxy;
    }

    /******************************************************************************************
     References to private resources
     ******************************************************************************************
     * registered instances reference
     ******************************************************************************************/
    get list() {
        return Controller.list;
    }

    /******************************************************************************************
     * training finish flag
     ******************************************************************************************/
    get finish() {
        return Controller.index >= Controller.list.length;
    }

    /******************************************************************************************
     A reference to current instance
     ******************************************************************************************/
    get current() {
        return Controller.list[Controller.index];
    }

    get correct() {
        return Controller.list.filter(item => item.isCorrect);
    }

    /******************************************************************************************
     Public Methods
     ******************************************************************************************
     Load training
     ******************************************************************************************/
    load() {
        return this.proxy
            .call('GetTraining')
            .then((data) => {
                Controller.clear();
                Controller.register(data);
            });
    }

    submit(answer) {
        this.current.isAnswered = true;
        this.current.isCorrect = this.current.answer === answer;
    }

    next() {
        !this.finish ? Controller.index++ : void 0;
    }
}